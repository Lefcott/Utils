<html>
    <head>
      <style>
        body {
          background-color: #cbf590;
          overflow: hidden;
        }
        .cell {
          position: absolute;
          background-color: #44b81d;
          border-style: solid;
          border-width: 0.5px;
          text-align: center;
          transition: 0.2s;
          cursor: pointer;
        }
        .cell:hover {
          background-color: #6d9e28;
          text-shadow: 0 0 3px;
        }
        .cellHead {
          background-color: #2ca105;
          border-style: solid;
          border-width: 1.2px;
          z-index: 2;
        }
        .msg {
          position: absolute;
          border-bottom-left-radius: 50px;
          border-top-left-radius: 50px;
          border-style: solid;
          border-width: 1px;
          background-color: #DDD;
          transition: 0.2s;
          left: 100%;
          top: 50%;
          transform: translate(0, -50%);
          width: 50%;
          height: 80%;
          z-index: 4;
        }
        .close {
          position: absolute;
          transform: translate(-100%);
          left: 99%;
          top: 1%;
          width: 80px;
          height: 40px;
          border-style: solid;
          border-width: 1.8px;
          background-color: #F55;
          text-align: center;
          font-size: 30px;
          cursor: pointer;
          transition: 0.2s;
          z-index: 2;
        }
        .close:hover {
          border-width: 0;
          font-size: 32px;
          background-color: #F77;
        }
        .title {
          position: absolute;
          font-size: 21px;
          width: 100%;
          transform: translate(-50%, -50%);
          left: 50%;
          top: 45px;
        }
        .subtitle {
          position: absolute;
          font-size: 16px;
          width: 100%;
          transform: translate(-50%, -50%);
          left: 50%;
          top: 70px;
        }
        .list {
          background-color: #BBB;
          position: absolute;
          left: 0;
          top: 100px;
        }
      </style>
    </head>
    <body onselectstart = 'return false;' oncontextmenu = 'return false;' onresize = 'resize();'>
      <h1 align = 'center'>Reporte de uso de WhatsApp - Edes</h1>
      <div class = 'msg' id = 'msg'>
        <div class = 'close' onclick = 'closeMsg();'>&times;</div>
        <div class = 'title' id = 'title'>T&iacute;tulo</div>
        <div class = 'subtitle' id = 'subtitle'>Subt&iacute;tulo</div>
        <table class = 'list' id = 'list'></table>
      </div>
      <script>
        const msg = document.getElementById('msg');
        const title = document.getElementById('title');
        const subtitle = document.getElementById('subtitle');
        const list = document.getElementById('list');
        const info = {
          'negocio.usuario.saludos.hola': {
            '01/01/2020': ['hola', 'HOLA!', 'hola que tal', 'HOLA!', 'Hola, como estas?'],
            '02/01/2020': ['holp', 'hello', 'hi', 'HELLLO!!'],
          },
          'negocio.usuario.saludos.adios': {
            '03/01/2020': ['chau', 'Chau!', 'chau nos vemos', 'Chau, hasta la proxima'],
            '04/01/2020': ['bye', 'bye bye', 'Goodbye', 'BYE!!'],
            '05/01/2020': ['bye', 'bye bye', 'Goodbye', 'BYE!!'],
            '06/01/2020': ['bye', 'bye bye', 'Goodbye', 'BYE!!'],
            '06/01/2020': ['bye', 'bye bye', 'Goodbye', 'BYE!!'],
            '07/01/2020': ['bye', 'bye bye', 'Goodbye', 'BYE!!'],
            '08/01/2020': ['bye', 'bye bye', 'Goodbye', 'BYE!!']
          }
        };
        let cols = [], rows = Object.keys(info);
        const iniTop = 50;
        const maxCols = 6, maxRows = 10;
        const firstColWidth = 200, firstRowHeight = 45;
        let width = 85, height = 50, maxWidth = 150, maxHeight = 80;
        let currRow = null, currCol = null, currDiffX = 0, currDiffY = 0;
        setCols();
        const actualCols = Math.min(maxCols, cols.length);
        const actualRows = Math.min(maxRows, rows.length);
        const pagesX = Math.ceil(cols.length / actualCols);
        const pagesY = Math.ceil(rows.length / actualRows);
        const buttonWidth = 25, buttonHeight = 20, buttonsBottom = actualCols + 2, buttonsRight = actualRows + 2;
        const buttonSelected = { borderWidth: '2px', zIndex: 2 };
        const buttonUnselected = { borderWidth: '0.5px', zIndex: 1 };
        resize();
        function setCols() {
          cols = {};
          const infoKeys = Object.keys(info);
          for (let k = 0; k < infoKeys.length; k += 1) {
            const dates = Object.keys(info[infoKeys[k]]);
            for (let m = 0; m < dates.length; m += 1) {
              cols[dates[m]] = 1;
            }
          }
          cols = Object.keys(cols);
        }
        function setFirstCol() {
          for (let k = 0; k < actualRows; k += 1) {
            const cell = document.createElement('div');
            cell.setAttribute('class', 'cell cellHead');
            cell.style.left = 0;
            cell.style.top = `${iniTop + firstRowHeight + k * height}px`;
            cell.style.width = `${firstColWidth}px`;
            cell.style.height = `${height}px`;
            cell.innerHTML = rows[k];
            document.body.appendChild(cell);
          }
        }
        function setFirstRow() {
          for (let k = 0; k < actualCols; k += 1) {
            const cell = document.createElement('div');
            cell.setAttribute('class', 'cell cellHead');
            cell.style.left = `${firstColWidth + k * width}`;
            cell.style.top = `${iniTop}px`;
            cell.style.width = `${width}px`;
            cell.style.height = `${firstRowHeight}px`;
            cell.innerHTML = cols[k - currDiffX];
            document.body.appendChild(cell);
          }
        }
        function isCellVisible(row, col) {
          return !(row + 1 + currDiffY > actualRows || col + 1 + currDiffX > actualCols);
        }
        function isCellRight(col) {
          return col + currDiffX === actualCols - 1;
        }
        function isCellBottom(row) {
          return row + currDiffY === actualRows - 1;
        }
        function setTable() {
          for (let k = 0; k < rows.length; k += 1) {
            for (let m = 0; m < cols.length; m += 1) {
              const cell = document.getElementById(`${k}_${m}`) || document.createElement('div');
              cell.setAttribute('class', 'cell');
              cell.setAttribute('onclick', `clickCell(event.target, ${k}, ${m})`);
              cell.id = `${k}_${m}`;
              cell.style.left = `${firstColWidth + (m + currDiffX) * width}`;
              cell.style.top = `${iniTop + firstRowHeight + (k + currDiffY) * height}px`;
              cell.style.width = `${isCellRight(m) ? width - buttonWidth : width}px`;
              cell.style.height = `${isCellBottom(k) ? height - buttonHeight : height}px`;
              cell.style.opacity = isCellVisible(k, m) ? 1 : 0;
              cell.innerHTML = info[rows[k]][cols[m]] ? info[rows[k]][cols[m]].length : 0;
              document.body.appendChild(cell);
            }
          }
        }
        function clickCell(cell, row, col) {
          
          if (currRow === row && currCol === col) {
            closeMsg();
          } else {
            msg.style.left = `${innerWidth / 2}px`;
            currRow = row;
            currCol = col;
            title.innerHTML = rows[row];
            subtitle.innerHTML = cols[col];
            setList(row, col);
          }
        }
        function closeMsg() {
          msg.style.left = '100%';
          currRow = null;
          currCol = null;
        }
        function setList(row, col) {
          list.innerHTML = `<tr><th style = 'width: 77.7%'>Consulta</th><th>Ocurrencias</th></tr>`;
          const phrases = info[rows[row]][cols[col]] || [];
          const insertedPhrases = [];
          for (let k = 0; k < phrases.length; k += 1) {
            if (!insertedPhrases.includes(phrases[k])) {
              list.innerHTML += `<tr><td>${phrases[k]}</td><td align = 'center'>${occInArr(phrases, phrases[k])}</td></tr>`;
              insertedPhrases.push(phrases[k]);
            }
          }
        }
        function occInArr(arr, search) {
          let count = 0;
          for (let k = 0; k < arr.length; k += 1) {
            if (arr[k] === search) {
              count += 1;
            }
          }
          return count;
        }
        function resize() {
          width = Math.min((innerWidth - firstColWidth) / actualCols, maxWidth);
          height = Math.min((innerHeight - firstRowHeight) / actualRows, maxHeight);
          setFirstCol();
          setFirstRow();
          setTable();
          setButtonsBottom();
          setButtonsRight();
          move(0, 0);
        }
        function setStyle(style, target) {
          const styleKeys = Object.keys(style);
          if (target) {
            for (let k = 0; k < styleKeys.length; k += 1) {
                target.style[styleKeys[k]] = style[styleKeys[k]];
            }
          }
        }
        function unSelectPage(x, y) {
          const buttonRight = document.getElementById(`buttonRight_${y}`);
          const buttonBottom = document.getElementById(`buttonBottom_${x}`);
          setStyle(buttonUnselected, buttonRight);
          setStyle(buttonUnselected, buttonBottom);
        }
        function selectPage(x, y) {
          const buttonRight = document.getElementById(`buttonRight_${y}`);
          const buttonBottom = document.getElementById(`buttonBottom_${x}`);
          setStyle(buttonSelected, buttonRight);
          setStyle(buttonSelected, buttonBottom);
        }
        function move(diffX, diffY) {
          // TODO remove console
          console.log(`Move ${diffX}, ${diffY}`);
          
          diffX = diffX || 0;
          diffY = diffY || 0;
          if (cols.length - actualCols + currDiffX + diffX < 0 || currDiffX + diffX > 0 ||
              rows.length - actualRows + currDiffY + diffY < 0 || currDiffY + diffY > 0) {
            return;
          }
          unSelectPage(-currDiffX + 1, -currDiffY + 1);
          currDiffX += diffX || 0;
          currDiffY += diffY || 0;
          selectPage(-currDiffX + 1, -currDiffY + 1);
          for (let k = 0; k < rows.length; k += 1) {
            for (let m = 0; m < cols.length; m += 1) {
              const cell = document.getElementById(`${k}_${m}`);
              if (cell) {
                cell.style.opacity = isCellVisible(k, m) ? 1 : 0;
                cell.style.left = `${firstColWidth + (m + currDiffX) * width}`;
                cell.style.top = `${iniTop + firstRowHeight + (k + currDiffY) * height}px`;
                cell.style.width = `${isCellRight(m) ? width - buttonWidth : width}px`;
                cell.style.height = `${isCellBottom(k) ? height - buttonHeight : height}px`;
              }
            }
          }
          setFirstRow();
          setFirstCol();
          setButtonsBottom();
          setButtonsRight();
        }
        function setButtonsBottom() {
          const buttonWidthThis = (actualCols * width - buttonWidth) / buttonsBottom;
          for (let k = 0; k < buttonsBottom; k += 1) {
            const button = document.getElementById(`buttonBottom_${k}`) || document.createElement('div');
            button.id = `buttonBottom_${k}`;
            button.setAttribute('class', 'cell');
            button.style.width = `${buttonWidthThis}px`;
            button.style.height = `${buttonHeight}px`;
            button.style.left = `${firstColWidth + k * buttonWidthThis}px`;
            button.style.top = `${iniTop + firstRowHeight + actualRows * height - buttonHeight}px`;
            switch (k) {
              case 0:
                button.innerHTML = '&larr;';
                button.setAttribute('onclick', 'move(1, 0)');
                break;
              case k === buttonsBottom - 1:
                button.innerHTML = '&rarr;';
                button.setAttribute('onclick', 'move(-1, 0)');
                break;
              default:
                button.setAttribute('onclick', `move(${k - (-currDiffX + 1)}, 0)`);
                button.innerHTML = k;
                break;
            }
            document.body.appendChild(button);
          }
        }
        function setButtonsRight() {
          const buttonHeightThis = (actualRows * height - buttonHeight) / buttonsRight;
          for (let k = 0; k < buttonsRight; k += 1) {
            const button = document.getElementById(`buttonRight_${k}`) || document.createElement('div');
            button.id = `buttonRight_${k}`;
            button.setAttribute('class', 'cell');
            button.style.width = `${buttonWidth}px`;
            button.style.height = `${buttonHeightThis}px`;
            button.style.left = `${firstColWidth + actualCols * width - buttonWidth}px`;
            button.style.top = `${iniTop + firstRowHeight + k * buttonHeightThis}px`;
            button.innerHTML = k;
            if (k === 0) {
              button.innerHTML = '&uarr;';
              button.setAttribute('onclick', 'move(0, 1)');
            }
            if (k === buttonsRight - 1) {
              button.innerHTML = '&darr;';
              button.setAttribute('onclick', 'move(0, -1)');
            }
            document.body.appendChild(button);
          }
        }
      </script>
    </body>
</html>